<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>
    <title>roots simple pagination | YUKIMEMI</title>

    
    <link href="/css/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"/>
    <link href="/css/desert.css" type="text/css" rel="stylesheet"/>
    <link href="/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  </head>
  <body>
    <nav class="deep-orange lighten-1 valign-wrapper" role="navigation">
      <div class="container">
        <div class="nav-wrapper center-align">
          <a href="/" id="title" class="valign">YUKIMEMI</a>
        </div>
      </div>
    </nav>

<div id="post" class="container">
  <div class="row">
    <div class="col s10 offset-s1">
      <h2 class="pink-text">roots simple pagination</h2>
      <p class="orange-text text-darken-4">2014/07/09 Wed</p>
      

<p>rootsは非常にシンプルで良いのだが、シンプルが故に通常のブログだと当たり前な部分を自分で実装しなければいけないところがある。</p>

<p>その一つが、ページネーション。</p>

<p>rootsでブログテンプレートを作成した場合、トップページはページネーションされず、書いていったブログ記事が全部リストで並ぶことになる。</p>

<p>まぁそんなたいした量を書いてないんで問題ないのだけれども、一応ブログとしてページネーションくらいはあったほうがいいと思い、実装方法を探してみた。</p>

<p>rootsは静的サイトジェネレーターなので、通常だとjadeの記法などでコンパイル時に出来るんだろうけど、今回はjqueryで簡単に出来る <a href="http://flaviusmatis.github.io/simplePagination.js/">simplePagination.js</a> というものが見つかったので、それを追加してみた。</p>

<h3 id="インストール:6d359caa743518f0339530aa8cdf1d76">インストール</h3>

<p>まず、追加するのにはbowerを使った。
ちなみにローカルにインストールしたbowerを使う方法は、<a href="http://yukimemi.github.io/posts/2014-07-02_direnv%20for%20npm%20local%20commands.html">前の記事</a> を参照。</p>

<pre><code class="language-sh">$ npm install bower --save-dev
</code></pre>

<p>事前準備として、bowerのコンポーネントがインストールされる先を変更しておく。</p>

<p>roots のルートで、</p>

<pre><code class="language-sh">$ vim .bowerrc
</code></pre>

<p>し、以下を記載。</p>

<pre><code class="language-javascript">{
    &quot;directory&quot;: &quot;assets/bower_components&quot;
}
</code></pre>

<p>その後、bowerにて、 <a href="http://flaviusmatis.github.io/simplePagination.js/">simplePagination.js</a> をインストールする。</p>

<pre><code class="language-sh">$ bower install jquery.simplePagination --save
</code></pre>

<p>これで、 <code>assets/bower_components</code> 配下に保存される。</p>

<h3 id="simplepagination-js-http-flaviusmatis-github-io-simplepagination-js-設定:6d359caa743518f0339530aa8cdf1d76"><a href="http://flaviusmatis.github.io/simplePagination.js/">simplePagination.js</a> 設定</h3>

<h4 id="jade側の設定:6d359caa743518f0339530aa8cdf1d76">jade側の設定</h4>

<p>まずは、ページネーションの配置。</p>

<pre><code class="language-sh">$ vim views/layout.jade
</code></pre>

<pre><code class="language-javascript">--- 省略 ---
#main
  != content
  .pagination
--- 省略 ---
</code></pre>

<p>divのclassで設定。単純に <code>pagination</code> というclassにて、divを配置しただけ。</p>

<p>それから、stylusでの設定がしやすいように、ブログ記事のリストにclassを設定しておく。</p>

<pre><code class="language-sh">$ vim views/index.jade
</code></pre>

<pre><code class="language-jade">ul#posts
  - each post in sort(site.posts, { by: 'date' })
    li.plist
      p
        a(href=&quot;\#{post.url}&quot;)= post.title
</code></pre>

<p><code>ul#posts -&gt; li</code> に、class <code>plist</code> を追加しただけ。</p>

<h4 id="stylus側の設定:6d359caa743518f0339530aa8cdf1d76">stylus側の設定</h4>

<pre><code class="language-sh">$ vim assets/css/master.styl
</code></pre>

<p>最初はすべてのブログ記事リストを見えなくしておく。</p>

<pre><code class="language-stylus">#posts
  .plist
    display: none
</code></pre>

<h4 id="coffee側の設定:6d359caa743518f0339530aa8cdf1d76">coffee側の設定</h4>

<p><code>assets/js/main.coffee</code> に設定を記述していく。</p>

<pre><code class="language-sh">$ vim assets/js/main.coffee
</code></pre>

<p>記載内容 ↓</p>

<pre><code class="language-javascript">#= require &quot;_helper&quot;

# Add scripts to load to this array. These can be loaded remotely like jquery
# is below, or can use file paths, like 'vendor/underscore'
jq = [&quot;http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js&quot;]
js = [&quot;/bower_components/jquery.simplePagination/jquery.simplePagination.js&quot;]


# this will fire once the required scripts have been loaded
require jq, -&gt;
  require js, -&gt;
    $ -&gt;
      console.log 'jquery loaded, dom ready &lt;-- via assets/js/main.coffee'

      # Pagination
      items = $('#posts li')
      numItems = items.length
      perPage = 21

      # only show the first perPage items initially
      items.slice(0, perPage).show()

      # now setup your pagination
      $('.pagination').pagination
        items: numItems
        itemsOnPage: perPage
        cssStyle: &quot;light-theme&quot;
        onPageClick: (pageNumber) -&gt;
          showFrom = perPage * (pageNumber - 1)
          showTo = showFrom + perPage

          items.hide()
               .slice(showFrom, showTo).show()
</code></pre>

<p>javascriptのロードはrequire.jsで行うので、jade側への追記はなし。</p>

<p>rootsはデフォルトで、jqueryのロードは行っているようだったので、追加で <a href="http://flaviusmatis.github.io/simplePagination.js/">simplePagination.js</a> の設定を追加していった。
最初、jqueryと同じ配列に <a href="http://flaviusmatis.github.io/simplePagination.js/">simplePagination.js</a> を組み込んでいたのだが、 <a href="http://flaviusmatis.github.io/simplePagination.js/">simplePagination.js</a> はjqueryが読み込まれた後でないと正常に実行されないようなので、必ずjqueryが先に読み込まれるように、jqueryとそれ以外というように配列を分け、コールバックを一つ深くした。</p>

<ul>
<li>16L でまず対象のリストのセレクタをゲット</li>
<li>17L で、リストの数をゲット。</li>
<li>18L で、1ページに表示するリストの数を指定。</li>
<li>21L で、最初の1ページだけを表示。</li>
<li>24L から、 <a href="http://flaviusmatis.github.io/simplePagination.js/">simplePagination.js</a> の設定。</li>
<li>25L で、 17L でゲットしたリストの数を指定。</li>
<li>26L で、 18L で指定した1ページに表示するリストの数を設定。</li>
<li>27L で、 <a href="http://flaviusmatis.github.io/simplePagination.js/">simplePagination.js</a> のテーマを指定。</li>
<li>28L から、ページネーションのボタンが押下された時の実装を指定。現在のページ番号が <code>pageNumber</code> に入っている。</li>
<li>29L で、表示するリストの開始番号を算出。</li>
<li>30L で、表示するリストの終了番号を算出。</li>
<li>32-33L で、一度リストを全部非表示にして、必要なところだけ表示する。</li>
</ul>

<p>今度はjadeでコンパイル時にページネーション実装してみたい。</p>

<hr />

<h5 id="参考:6d359caa743518f0339530aa8cdf1d76">参考</h5>

<p><a href="http://flaviusmatis.github.io/simplePagination.js/">simplePagination.js</a></p>

<p><a href="http://stackoverflow.com/questions/20896076/how-to-use-simplepagination-jquery">javascript - How to use SimplePagination jquery - Stack Overflow</a></p>

    </div>
  </div>
</div>

<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>
<script src="/js/prettify.js"></script>
<script src="/js/main.js"></script>

</body>
</html>

